---

- name: "Install"
  apt: name={{ item }} update_cache=yes state=latest force_apt_get=yes
  loop: ['php-cli','unzip','php-tokenizer','php-bcmath','composer']

- name: "composer global require laravel/installer"
  shell: sudo composer global require laravel/installer

- name: "composer global require laravel/installer"
  shell: sudo rm -rf /var/www/{{ http_host }}

- name: "create laravel project"
  shell: sudo composer create-project  --prefer-dist laravel/laravel /var/www/{{ http_host }}

- name: "grant priv"
  shell: sudo chown -R www-data:www-data /var/www

- name: "ReSet up virtualhost"
  template:
    src: "files/apache.conf.j2"
    dest: "/etc/apache2/sites-available/{{ http_conf }}"
  notify: restart apache

- name: "Set up db"
  template:
    src: "files/database.php"
    dest: "/var/www/{{ http_host }}/config/database.php"
  notify: restart postgresql

- name: "1"
  shell: sudo sed -i 's/DB_CONNECTION=mysql/DB_CONNECTION=pgsql/' /var/www/{{ http_host }}/.env

- name: "2"
  shell: sudo sed -i 's/DB_PORT=3306/DB_PORT=5432/' /var/www/{{ http_host }}/.env

- name: "3"
  shell: sudo sed -i 's/DB_DATABASE=laravel/DB_DATABASE=rtubase/' /var/www/{{ http_host }}/.env

- name: "4"
  shell: sudo sed -i 's/DB_USERNAME=root/DB_USERNAME=postgres/' /var/www/{{ http_host }}/.env

- name: "5"
  shell: sudo sed -i 's/DB_PASSWORD=/DB_PASSWORD=rtub/' /var/www/{{ http_host }}/.env

- name: Run command on specific folder
  command: php artisan migrate
  args:
    chdir: /var/www/{{ http_host }}

- name: Run command on specific folder
  command: sudo composer require laravel/ui
  args:
    chdir: /var/www/{{ http_host }}

- name: Run command on specific folder
  command: php artisan ui vue --auth
  args:
    chdir: /var/www/{{ http_host }}

- name: Run command on specific folder
  command: sudo composer require laravel/socialite
  args:
    chdir: /var/www/{{ http_host }}

